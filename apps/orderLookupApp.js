var jq;
var formTemp;
var emptyerror = "Please fill out all fields.";
var emailerror = "Please enter a valid email address.";
var proxyPathLookup = "/apps/orderlookupapp/lookup";
var proxyPathEmail = "/apps/orderlookupapp/email";
var proxyPathTracking = "/apps/orderlookupapp/tracking";
var formBody = "<style type=\"text\/css\">#ola_submitButton, #ola_backButton, .ola_trackingDetailLink {background-color: #498a02;color: #ffffff;}#ola_error{}#ola_orderLookUp_formWrapper .needsfilled{}#ola_lookupForm{}<\/style> <div id=\"ola_orderLookUp_formWrapper\"> <p id=\"ola_formHeaderText\">Search below for your order status. <br> <br> You can find your order number in the Order Confirmation Email and will start with \"CS\". For example, CS16243. <br> <br> If you don't know your order number click the \"Lookup With Email Only\" link under the \"Find Order\" button below and your order list will be emailed to you. <br><\/p> <form id=\"ola_lookupForm\" onsubmit=\"event.preventDefault();\"> <input type=\"hidden\" name=\"ignore\" id=\"ola_ignore\" value=\"\" \/> <input type=\"hidden\" name=\"hash\" id=\"ola_hash\" value=\"\" \/> <span id=\"ola_orderEmailField\"> <label for=\"ola_email\">Email Address <\/label> <input type=\"text\" name=\"email\" id=\"ola_email\" value=\"\" \/> <\/span> <span id=\"ola_orderNumberField\"> <label for=\"ola_orderNumber\">Order Number<\/label> <input type=\"text\" name=\"orderNumber\" id=\"ola_orderNumber\" value=\"\" \/> <\/span> <div id=\"ola_error\" style=\"display:none;\"><\/div> <input type=\"button\" value=\"Find Order\" id=\"ola_submitButton\" class=\"btn button\" \/> <div> <a href=\"#\" id=\"ola_emailLookupLink\">Lookup with email only<\/a> <a href=\"#\" id=\"ola_lookupLink\" style=\"display: none;\">I know my order number<\/a> <\/div> <\/form> <div id=\"ola_searching\" style=\"display:none;\">Please wait, searching...<\/div> <\/div> <div id=\"ola_orderLookUp_result\" style=\"display:none;\" \/>"; //already json encoded
var cssURL= "https://orderlookupapp.com/dist/app/css/orderLookup_v2.css";
var emailOnly = false;

var tryCount = 0;
var retryLimit = 6;

var lang = {"checkpoint_error_title":"Error","checkpoint_error_message":"An error has occured while tracking your order","checkpoint_infoReceived_title":"Information Recieved","checkpoint_infoReceived_message":"Carrier has received request from shipper and is about to pick up the shipment","checkpoint_pending_title":"Pending","checkpoint_pending_message":"Please try again later, we are awaiting tracking info from the carrier","checkpoint_cantTrack_title":"Shipment can not be tracked","checkpoint_cantTrack_message":"Tracking information is not avaliable from this carrier"}; //already json encoded

var dateFormatCode = 0;

var autoExpand = "1";function ola_getScript(e,a){var t=document.createElement("script");t.src=e;var o=document.getElementsByTagName("head")[0],l=!1;t.onload=t.onreadystatechange=function(){l||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(l=!0,a(),t.onload=t.onreadystatechange=null,o.removeChild(t))},o.appendChild(t)}function ola_loadCSS(){document.createStyleSheet?document.createStyleSheet(cssURL):jq('<link rel="stylesheet" type="text/css" href="'+cssURL+'" />').appendTo("head")}function ola_doSubmit(){var e=jq("#ola_lookupForm"),a=e.find("input, select, button, textarea"),t=e.serialize(),o=jq("#ola_searching");e.fadeTo(500,.2),o.show(),a.attr("disabled","disabled");var l=proxyPathLookup;!0===emailOnly&&(l=proxyPathEmail),jq.ajax({type:"POST",url:l,dataType:"html",data:t}).done(function(a,t,l){jq("#ola_orderLookUp_result").html(a),e.fadeTo(1,1),o.hide(),ola_autoExpandDetails()}).fail(function(a,t,o){e.fadeTo(500,1)}).always(function(t,l,i){e.fadeTo(1,1),o.hide(),jq("#ola_backButton").click(function(){jq("#ola_orderNumber").val(""),jq("#ola_email").val(""),jq("#ola_hash").val(""),jq("#ola_orderLookUp_result").hide(),jq("#ola_orderLookUp_formWrapper").show()}),jq("#ola_orderLookUp_formWrapper").hide(),jq("#ola_orderLookUp_result").show(),a.removeAttr("disabled")})}function ola_doValidate(){var e;e=!1===emailOnly?["ola_orderNumber","ola_email"]:["ola_email"];for(var a=jq("#ola_email"),t=jq("#ola_error"),o="",l=0;l<e.length;l++){var i=jq("#"+e[l]);""===i.val()||i.val()===emptyerror?(i.addClass("needsfilled"),o=emptyerror):i.removeClass("needsfilled")}if(a.val(jq.trim(a.val())),!1===/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a.val())&&32!=a.val().length&&(a.addClass("needsfilled"),o=""!=o?o+"<br/>"+emailerror:emailerror),jq(":input").hasClass("needsfilled"))return t.html(o),t.show(),!1;t.html(""),t.hide(),ola_doSubmit()}function ola_showEmailToggle(){jq("#ola_emailLookupLink").toggle(),jq("#ola_lookupLink").toggle(),jq("#ola_orderNumberField").toggle(),emailOnly=!emailOnly}function ola_getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=a.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function ola_preLoaded(){var e=ola_getParameterByName("ordernumber"),a=ola_getParameterByName("email"),t=ola_getParameterByName("ignore"),o=ola_getParameterByName("hash");(e&&o||e&&a)&&(jq("#ola_orderNumber").val(e),jq("#ola_email").val(a),jq("#ola_ignore").val(t),jq("#ola_hash").val(o),ola_doSubmit())}function ola_autoExpandDetails(){1==autoExpand&&jq("#ola_orderDetailsLink").click()}function ola_autoExpandTracking(){jq(".ola_trackingDetailLink").click()}function ola_parseIsoDatetime(e){var a=e.split(/[: T-]/).map(parseFloat);return new Date(a[0],a[1]-1,a[2],a[3]||0,a[4]||0,a[5]||0,0)}function ola_formatAMPM(e){var a=e.getHours(),t=e.getMinutes(),o=a>=12?"pm":"am";return a%=12,a=a||12,t=t<10?"0"+t:t,a+":"+t+" "+o}function ola_dateFormat(e,a){if(0===a)return e;if(1===a)return e.replace("-","/");var t=e.split("-");return 2===a?t[1]+"-"+t[2]+"-"+t[0]:3===a?t[1]+"/"+t[2]+"/"+t[0]:4===a?t[2]+"."+t[1]+"."+t[0]:e}function ola_processCheckPoints(e){var a,t,o,l='<div class="checkpoints"><ul class="checkpoints_list">',i=e.checkpoints,n=0,r=!1;return i.forEach(function(e){var i=ola_parseIsoDatetime(e.checkpoint_time),s=i.getMonth()+1;s<10&&(s="0"+s);var c=i.getDate();c<10&&(c="0"+c);var d=i.getFullYear()+"-"+s+"-"+c;d=ola_dateFormat(d,dateFormatCode);var _=ola_formatAMPM(i),p=e.message,u=e.slug,h=e.location,v=e.tag;switch(null===h&&(h=""),a='<li class="checkpoint">',a+='<div class="checkpoint_time">',a+="<strong>"+d+"</strong>",a+='<div class="hint">'+_+"</div>",a+="</div>",v){case"InfoReceived":a+='<div class="checkpoint_icon inforeceived"></div>',n+=10;break;case"InTransit":a+='<div class="checkpoint_icon intransit"></div>',n+=10;break;case"OutForDelivery":a+='<div class="checkpoint_icon outfordelivery"></div>',n+=10;break;case"Delivered":a+='<div class="checkpoint_icon delivered"></div>',r=!0,t=p,o=d;break;case"attemptfail":a+='<div class="checkpoint_icon attemptfail"></div>';break;case"exception":a+='<div class="checkpoint_icon exception"></div>';break;case"expired":a+='<div class="checkpoint_icon expired"></div>';break;case"pending":a+='<div class="checkpoint_icon pending"></div>';break;default:a+='<div class="checkpoint_icon"></div>'}a+='<div class="checkpoint_content">',a+="<strong>"+p+'<span class="checkpoint_courier-name">'+u+"</span></strong>",a+='<div class="hint">'+h+"</div>",a+="</div>",a+="</li>",l+=a}),!0===r?n=100:n>=100&&(n=85),l+="</ul></div>",{output:l,percent:n,shipmentTag:e.tag,expected:e.expected,delivered:r,deliveryDate:o,deliveryMessage:t}}function ola_processStatus(e){var a,t=lang.checkpoint_error_title,o=lang.checkpoint_error_message;return"InfoReceived"===e.tag&&(t=lang.checkpoint_infoReceived_title,o=lang.checkpoint_infoReceived_message),"Pending"===e.tag&&(t=lang.checkpoint_pending_title,o=lang.checkpoint_pending_message),-1!==e.tag.indexOf("OLA_CantTrack")&&(t=lang.checkpoint_cantTrack_title,o=lang.checkpoint_cantTrack_message),a='<div class="ola_noCheckpoints">',a+='\t<div class="ola_noCheckpointsTitle">'+t+"</div>",a+='\t<div class="ola_noCheckpointMessage">'+o+"</div>",a+="</div>"}function ola_getStatus(e){var a="#ola_loading_"+e,t="#ola_tracking_"+e,o="#ola_details_"+e,l="#ola_notShipped_"+e,i="#ola_percentBar_"+e,n="#ola_expected_"+e,r="#ola_delivered_"+e;jq.ajax({type:"GET",url:proxyPathTracking,dataType:"json",data:{trackingID:e}}).done(function(s,c,d){if("Pending"===s.tag||"InfoReceived"===s.tag)tryCount++,tryCount<=retryLimit-1?setTimeout(function(){ola_getStatus(e)},7e3):(jq(l).html(ola_processStatus(s)),jq(a).hide(),jq(l).show());else if(-1!==s.tag.indexOf("OLA_CantTrack"))jq(l).html(ola_processStatus(s)),jq(a).hide(),jq(l).show();else{var _=ola_processCheckPoints(s);if(jq(o).html(_.output),!0===_.delivered)jq(r+" .ola_deliveryDate").html("("+_.deliveryDate+")"),jq(r+" .ola_deliveryMessage").html(_.deliveryMessage),jq(r).show();else{null===_.expected&&(_.expected="Unknown");var p="Expected Delivery "+_.expected;jq(n).html(p)}jq(i).width(_.percent+"%"),jq(a).hide(),jq(t).show(),1==autoExpand&&ola_autoExpandTracking()}}).fail(function(t,o,l){tryCount++,tryCount<=retryLimit-1?setTimeout(function(){ola_getStatus(e)},7e3):jq(a).hide()}).always(function(e,a,t){})}function ola_getForm(){jq(jq.parseHTML(formBody)).insertAfter(jq("#nll_orderLookUpHook")),jq(":input").focus(function(){jq(this).hasClass("needsfilled")&&jq(this).removeClass("needsfilled")}),jq("#ola_submitButton").click(ola_doValidate),jq("#ola_emailLookupLink").click(function(e){e.preventDefault(),ola_showEmailToggle()}),jq("#ola_lookupLink").click(function(e){e.preventDefault(),ola_showEmailToggle()}),jq("#ola_orderLookUp_result").on("click","#ola_orderDetailsLink",function(e){return e.preventDefault(),jq("#ola_orderDetailsLink").hide(),jq("#ola_orderDetailsWrapper").slideDown(),!1}),jq("#ola_orderLookUp_result").on("click","#ola_orderDetailsClose",function(e){return e.preventDefault(),jq("#ola_orderDetailsWrapper").slideUp(),jq("#ola_orderDetailsLink").show(),!1}),jq("#ola_orderLookUp_result").on("click",".ola_trackingDetailLink",function(e){e.preventDefault();var a="#ola_details_"+jq(this).attr("data-trackingID");return jq(a).slideToggle(),jq(this).text().trim()==jq(this).attr("data-text")?(jq(this).text(" x "),jq(this).parent().css("float","none")):(jq(this).parent().css("float","right"),jq(this).text(jq(this).attr("data-text"))),!1})}ola_getScript("//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js",function(){jq=$.noConflict(!0),ola_loadCSS(),ola_getForm(),ola_preLoaded()});